\section{Exploiting Injection}

\begin{frame}[fragile]{Bad sanitization: quoting}
  \ccode
  \begin{itemize}
    \item Quoted SQL statement:
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = '" + secretId + "'"
\end{lstlisting}
\pause
    \item Previous secretId \textbf{= 0 OR 1=1} won't work!
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = '0 OR 1=1'
\end{lstlisting}
\pause
    \item So, just send secretId \textbf{= 0' OR '1'='1}
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = '0' OR '1'='1'
\end{lstlisting}
    \item Celebrate
  \end{itemize}
\end{frame}

\begin{frame}[fragile]{Bad sanitization: blind escaping}
  \ccode
  \begin{itemize}
    \item Quoted SQL statement:
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = '" +
                             escapeQuotes(secretId) + "'"
\end{lstlisting}
\pause
    \item The previous trick won't work: secretId = \textbf{0' OR '1'='1}
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = '0\' OR \'1\'=\'1'
\end{lstlisting}
\pause
    \item However, a similar query without quotes won't be protected!
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = " +
                                   escapeQuotes(secretId)
\end{lstlisting}
\pause
    \item Just try \textbf{0 OR 1=1}
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = 0 OR 1 = 1
\end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]{Bad sanitization: string replace}
  \ccode
  \begin{itemize}
    \item Smartest fix ever:
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = " +
                              replace(secretId, 'OR', '')
\end{lstlisting}
\pause
    \item If secretId \textbf{= 0 OR 1=1}
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = 0 1 = 1"
\end{lstlisting}
\pause
    \item What if, secretId \textbf{= 0 OORR 1=1}
\begin{lstlisting}
"SELECT * FROM Secrets WHERE SecId = 0 OR 1 = 1"
\end{lstlisting}
  \end{itemize}
\end{frame}
